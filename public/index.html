<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>Accidental Palindrome</title>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>

  <body>
    <header>
      <h1>Accidental Palindrome</h1>
      <p class="caption">偶然発生する回文を探し当てる</p>
    </header>

    <article>
      <div class="container">
        <input id="query" value="Type Here...">
      </div>
      <div class="container">
        <p id="text"></p>
      </div>
      <div class="container">
        <table>
          <tr>
            <td class="label">最長の回文</td>
            <td id="longest"></td>
          </tr>
          <tr>
            <td class="label">読み</td>
            <td id="pronounce"></td>
          </tr>
          <tr>
            <td class="label">長さ</td>
            <td id="length"></td>
          </tr>
        </table>
      </div>
    </article>

    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script>
      //setup before functions
      var typingTimer;                //timer identifier
      var doneTypingInterval = 100;  //time in ms, 5 second for example
      var $input = $('#query');

      $input.on('keyup', function () {
        clearTimeout(typingTimer);
        typingTimer = setTimeout(doneTyping, doneTypingInterval);
      });

      $input.on('keydown', function () {
        clearTimeout(typingTimer);
      });

      //user is "finished typing," do something
      function doneTyping () {
          $.post("https://accidental-palindrome.herokuapp.com/find", { // TODO: make this configuable
            text: $('#query').val()
          }, function(data) {
            console.log(data)
            $("#text").html(data.text);
            $("#longest").html(data.longest_palindrome.surface);
            $("#pronounce").html(data.longest_palindrome.pronounce)
            $("#length").html(data.longest_palindrome.size)
          });
      }
    </script>
  </body>
</html>
